@inject Services Services
@inject BaseAppState AppState

<MudText Typo="Typo.h3" Align="Align.Center">@AppState.Translate(ResourceKeys.RegisterCommunity)</MudText>

<MudForm Model="@communityDto" @bind-IsValid="@success" @bind-Errors="@errors">
    <MudPaper Class="pa-4" Elevation="25">
        <MudTextField @bind-Value="@communityDto.Name" T="string" Label="@AppState.Translate(ResourceKeys.Name)" Required="true" RequiredError="@AppState.Translate(ResourceKeys.Required)" Variant="Variant.Outlined" />
        <MudTextField @bind-Value="@communityDto.Address" T="string" Label="@AppState.Translate(ResourceKeys.Name)" Required="true" RequiredError="@AppState.Translate(ResourceKeys.Required)" Variant="Variant.Outlined" />

        <MudSwitch T="bool" ValueChanged="onCurrencySwitch" Size="Size.Large" ThumbIcon="@Icons.Material.Filled.AttachMoney" >@AppState.Translate(ResourceKeys.OfficialCurrency) <img src="@selectedFlagCurrency" height="14" class="mr-1" /></MudSwitch>
        
      
        <MudText>@AppState.Translate(ResourceKeys.SelectAllOfficialLanguages)</MudText>
        
        <MudCheckBox @bind-Value="@officialLanguageEnglish" Color="Color.Info" Label="@AppState.Translate(ResourceKeys.English)" />
        <MudCheckBox @bind-Value="@officialLanguageSpanish" Color="Color.Success" Label="@AppState.Translate(ResourceKeys.Spanish)" />
        
        <MudTextField @bind-Value="@communityDto.Description" T="string" Label="@AppState.Translate(ResourceKeys.Description)" Required="true" RequiredError="@AppState.Translate(ResourceKeys.Required)" Variant="Variant.Outlined" />
        
        <MudButton Variant="Variant.Filled" FullWidth="true" Color="Color.Primary" Disabled="@(!success || disableButton)" Class="mt-5 mr-5" StartIcon="@Icons.Material.Filled.Save" OnClick="postForm">@AppState.Translate(ResourceKeys.Register)</MudButton>
        
        <!--HOMES PORTION-->
        <MudPaper Class="pa-4 ma-3" Elevation="25">
            <MudText Typo="Typo.h5" Align="Align.Left" Color="Color.Primary">@AppState.Translate(ResourceKeys.Homes)</MudText>

            <MudPaper Class="pa-4 ma-3" Elevation="25"><!--AUTOMATIC ADDITION OF HOMES-->
                <MudText>@AppState.Translate(ResourceKeys.AddHomesAutomaticallyDescription)</MudText>
                <MudTextField T="int" @bind-Value="@startingNumberAHA" Label="@AppState.Translate(ResourceKeys.HomesStartingNumber)" Variant="Variant.Outlined" />
                <MudTextField T="int" @bind-Value="@endingNumberAHA" Label="@AppState.Translate(ResourceKeys.HomesEndingNumber)" Variant="Variant.Outlined" />
                <MudTextField @bind-Value="@internalAddressAHA" T="string" Label="@AppState.Translate(ResourceKeys.InternalAddress)" Variant="Variant.Outlined" />
                <MudButton Variant="Variant.Filled" OnClick="@AutomaticallyAddHomes">@AppState.Translate(ResourceKeys.Add)</MudButton>
            </MudPaper> <!--END AUTOMATIC ADDITION OF HOMES-->
            
        
        </MudPaper>
        <!--DISPLAYING THE HOMES ALLOWING EDITING, ADDING AND REMOVING-->
        <!--END DISPLAYING THE HOMES ALLOWING EDITING, ADDING AND REMOVING-->
        <!--END HOMES PORTION-->
        
    </MudPaper>
</MudForm>
    @code {
    private CommunityDto communityDto = new CommunityDto()
        {
            CanHaveHomes = true,
            ProposalsExpirationDays = 30,
        };
    private bool success;
    string[] errors = [];

    private bool currencyBool; //false is USD, true is MXN
    private string selectedFlagCurrency = "https://upload.wikimedia.org/wikipedia/en/thumb/a/a4/Flag_of_the_United_States.svg/2880px-Flag_of_the_United_States.svg.png";
    private string usaFlag = "https://upload.wikimedia.org/wikipedia/en/thumb/a/a4/Flag_of_the_United_States.svg/2880px-Flag_of_the_United_States.svg.png";
    private string mxnFlag = "https://upload.wikimedia.org/wikipedia/commons/thumb/f/fc/Flag_of_Mexico.svg/2880px-Flag_of_Mexico.svg.png";

    bool disableButton = true;

    bool officialLanguageEnglish = false;
    bool officialLanguageSpanish = false;

    #region AUTOMATIC HOMES ADDITION VARIABLES
    private int startingNumberAHA;
    private int endingNumberAHA;
    private string internalAddressAHA = string.Empty;
    #endregion

    /// <summary>
    /// If false, USA, if true, MXN
    /// </summary>
    private void onCurrencySwitch()
    {
        currencyBool = !currencyBool;
        if(!currencyBool) selectedFlagCurrency = usaFlag;
        else selectedFlagCurrency = mxnFlag;
    }
    /// <summary>
    /// This is part of the automatic homes addition box. It will add homes automatically to the community.
    /// It needs to ensure that the initial number is lower than the final number and that neither are negative.
    /// FOR PURPOSES OF THIS FORM ONLY HomeDto.Id = HomeDto.Number
    /// </summary>
    private void AutomaticallyAddHomes()
    {
        if(startingNumberAHA < 0 || endingNumberAHA < 0 || startingNumberAHA > endingNumberAHA)
        {
            errors = new string[]{"starting and ending number cannot be negative and starting number cannot be smaller than ending number."};
            return;
        }
        for(int i = startingNumberAHA; i <= endingNumberAHA; i++)
        {
            HomeDto newHome = new();
            newHome.Id = i;
            newHome.Number = i;
            newHome.InternalAddress = internalAddressAHA;
            communityDto.AddHome(newHome);
        }
    }
    /// <summary>
    /// It checks the highest HomeDto.Number and assigns the next number to the new home.
    /// FOR PURPOSES OF THIS FORM ONLY HomeDto.Id = HomeDto.Number
    /// </summary>
    private void AddIndividualHome()
    {
        
    }
    private void postForm()
    {
        
    }
}
